# 1. Opção A - Média de salário por cargo para cada ano

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

sal = pd.read_csv('ds_salaries.csv', index_col = 0)

#sal.isna() #Mostra quais celulas estão vazias em um dataset
#sal.isna().any() #Contagem de celulas vazias de um dataset
#sal.describe() #Mostra vários valores estatisticos para o dataset

#Maior quantidade de funcionários
m = sal.groupby(by = 'job_title')['job_title'].count().nlargest(5)#.sort_values(ascending= False)

#Separando os valores que preciso por ano (salario e cargo)
cargos = ['Data Analyst','Data Engineer','Data Scientist','Machine Learning Engineer'] #Cargos com maior quantidade de pessoas

#Criei um subset filtrando do original, trazendo todas as linhas em que o cargo é igual aos que escolhi acima. Agrupei cada
#ano e cargo e calculei a média do salário em dolares. Removi o index depois para facilitar os filtros depois.
s = sal[sal['job_title'].isin(cargos)].groupby(by = ['work_year','job_title']).agg({'salary_in_usd':'mean'}).reset_index()

#Criei 3 novos subsets filtrando o anterior, cada um para um ano diferente. O resultado foi um dataset com a média dos salários
#de cada cargo para o respectivo ano
s20 = s[s['work_year'] == 2020]
s21 = s[s['work_year'] == 2021]
s22 = s[s['work_year'] == 2022]

#Espessura de cada barra
bar_width = 0.20

#Definindo posição das barras - uma para cada BARRA
r1 = np.arange(len(s20['job_title']))
r2 = [x + bar_width for x in r1]
r3 = [x + bar_width for x in r2]

plt.figure(figsize = (20,6))

#Criando as barras
b1 = plt.bar(r1, s20['salary_in_usd'], color = 'green', width = bar_width, label = '2020')
b2 = plt.bar(r2, s21['salary_in_usd'], color = 'blue', width = bar_width, label = '2021')
b3 = plt.bar(r3, s22['salary_in_usd'], color = 'red', width = bar_width, label = '2022')

#Adicionando legendas as barras
plt.xlabel('Cargos', size = 20)
plt.xticks([r + bar_width for r in range(len(r1))], s20['job_title'], size = 16)

#Incluindo rótulo de dados
plt.bar_label(b1, fmt="%.01f", size=13, label_type="edge")
plt.bar_label(b2, fmt="%.01f", size=13, label_type="edge")
plt.bar_label(b3, fmt="%.01f", size=13, label_type="edge")

plt.ylabel('Média de Salário (Dolar)', size = 20)
plt.yticks(size = 16, rotation = 30)

plt.title('Média de salário por cargo para cada ano', size = 22)
#plt.grid(True)

#Criando legenda e plotando
plt.legend(loc = 5, bbox_to_anchor =(0.6, 0, 0.5, 1), fontsize = 15)
plt.show()
